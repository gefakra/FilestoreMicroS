# üóÇ FileStoreService

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è **–±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ —Ñ–∞–π–ª–æ–≤** –Ω–∞ ASP.NET Core —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏, —Å–∂–∞—Ç–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞–º–∏.

![Architecture](https://github.com/user-attachments/assets/22376a54-de4b-4ec4-ac20-79d260ffb32c)

---

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* –í—ã—á–∏—Å–ª–µ–Ω–∏–µ **SHA256** –∏ **GZip-—Å–∂–∞—Ç–∏–µ** –Ω–∞ –ª–µ—Ç—É
* **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** –ø–æ —Ö—ç—à—É
* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ **–≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ —Ñ–∞–π–ª–æ–≤**
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ ¬´–æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏—Ö¬ª —Ñ–∞–π–ª–æ–≤
* –ü–æ–ª–Ω–æ—Å—Ç—å—é **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è** –æ–±—Ä–∞–±–æ—Ç–∫–∞
* –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –¥–∞–∂–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (**10‚Äì100 –ì–ë**)

---

## üîß REST API

| –ú–µ—Ç–æ–¥  | –ü—É—Ç—å                             | –û–ø–∏—Å–∞–Ω–∏–µ                              |
| ------ | -------------------------------- | ------------------------------------- |
| POST   | `/api/files?owner={guid}`        | –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ |
| GET    | `/api/files/{hash}`              | –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª                          |
| GET    | `/api/files/{hash}/exists`       | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ (204/404)           |
| DELETE | `/api/files/owner/{guid}`        | –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –≤–ª–∞–¥–µ–ª—å—Ü–∞           |
| DELETE | `/api/files/{hash}/owner/{guid}` | –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª —É –≤–ª–∞–¥–µ–ª—å—Ü–∞   |

**Swagger/OpenAPI** –≥–æ—Ç–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø–æ–¥—Ö–æ–¥

### –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å Pipeline

–ö–∞–∂–¥—ã–π —ç—Ç–∞–ø ‚Äî –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Å—Ç–∞–¥–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (SRP –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ—Ç–æ–∫–æ–≤):

1. **Reader**
   –ß–∏—Ç–∞–µ—Ç –≤—Ö–æ–¥–Ω–æ–π Stream, –Ω–∞—Ä–µ–∑–∞–µ—Ç –Ω–∞ –∫—É—Å–∫–∏ –∏ –ø–∏—à–µ—Ç –≤ `Channel<ReadOnlyMemory<byte>>`.
2. **Hasher**
   –í—ã—á–∏—Å–ª—è–µ—Ç SHA256 –Ω–∞ –ª–µ—Ç—É, –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–∞–ª—å—à–µ.
3. **Compressor**
   –°–∂–∏–º–∞–µ—Ç –±–ª–æ–∫–∏ —á–µ—Ä–µ–∑ GZip, –º–æ–∂–Ω–æ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.
4. **Writer**
   –°–æ—Ö—Ä–∞–Ω—è–µ—Ç `.gz` –Ω–∞ –¥–∏—Å–∫ –∏–ª–∏ –≤ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (S3/MinIO).

üí° –í—Å–µ —Å—Ç–∞–¥–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ**, –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ **–∫–∞–Ω–∞–ª—ã**, –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Ç–æ–∫–æ–≤.

---

### ‚ö° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

* **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å —Å—Ç–∞–¥–∏–π**: –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ Compressor‚Äô–æ–≤ –∏–ª–∏ Writer‚Äô–æ–≤
* **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏**: bounded channels, RAM ‚â§ ~512 KB –¥–∞–∂–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
* **ArrayPool<byte>**: –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±—É—Ñ–µ—Ä—ã, –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è GC-–Ω–∞–≥—Ä—É–∑–∫–∏
* **Cancellation**: –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–º –≤—Å–µ –∑–∞–¥–∞—á–∏ –∫–æ–Ω–≤–µ–π–µ—Ä–∞ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è

---

### üß© –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞

* –ù–µ—Ç –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ ‚Äî –ø–æ–ª–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å
* –†–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ –±–µ–∑ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
* –ü—Ä–æ—Å—Ç–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —ç—Ç–∞–ø–∞–º –∫–æ–Ω–≤–µ–π–µ—Ä–∞
* –í—ã—Å–æ–∫–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤

---

### üîÑ –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Pipeline —á–µ—Ä–µ–∑ –≥—Ä–∞—Ñ –∏–ª–∏ GIF
* –ú–µ—Ç—Ä–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (—á–µ—Ä–µ–∑ Prometheus/Grafana)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Ç–æ–∫–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ S3/MinIO –Ω–∞–ø—Ä—è–º—É—é
* –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ soft-delete

---

### üì¶ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

* **ASP.NET Core** 7+
* **C#** —Å async/await –∏ Channels
* **ArrayPool<byte>** –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–∞–º—è—Ç–∏
* **GZipStream** –¥–ª—è —Å–∂–∞—Ç–∏—è
* **SHA256** –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ **–ª–æ–∫–∞–ª—å–Ω–æ–º –¥–∏—Å–∫–µ** –∏–ª–∏ **S3/MinIO**

